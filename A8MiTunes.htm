<!--Assignment: MiTunes
	Author: Jakub Holewik
	ID: B615637
	Login: cojrh2-->

<!DOCTYPE html>
<html>
	<head>
		<title>MiTunes</title>
		<style type="text/css">
			.display
			{
				border: 2px solid black;
				display: inline-block;
				overflow: scroll;
				height: 450px;
				width: 400px;
				color: black;
			}

			.choice:hover
			{
				background-color: grey;
				cursor: pointer;
			}

			.found
			{
				background-color: green;
			}

			#keyboard
			{
				border: 5px solid red;
				height: 350px;
				width: 1200px;
			}

			.key
			{
				border: 3px solid blue;
				display: inline;
				font-size: 30px;
				padding: 0;
			}

			.key:hover
			{
				background-color: grey;
				cursor: pointer;
			}
		</style>
		<script type="text/javascript" src="music.js" /></script>
		<script type="text/javascript">
			//This function generates a song tab, whenever a new song is selected
			function generateSongData(album_id, song_id)
			{
				var alb = albums[album_id];
				var track = alb.tracks[song_id];
				var path = "audio/" + alb.artist + "/" + alb.title + "/" + track.mp3.substring(0, track.mp3.length - 4);
				var code =  "<img src='artwork/" + alb.artwork + ".jpg' />" +
							"<p>" + alb.artist + "<br />" + alb.title + "</p>" +
							"<p>Track " + (song_id + 1) + "/" + alb.tracks.length + "<br />" + track.title + "</p>" +
							"<audio controls='controls'>" +
							"<source src='" + path +".mp3' type='audio/mpeg'>" +
							"<source src='" + path +".wav' type='audio/wav'>" +
							"Your browser does not support the audio element.</audio>";

				current_track.innerHTML = code;
			}

			//This function generates code for the track list, whenever a new album is chosen
			function generateTrackList(album_id)
			{
				var alb = albums[album_id];
				var code = alb.title + "<br />by " + alb.artist;
				
				for(i in alb.tracks)
				{
					code += "<p class='choice' onclick='generateSongData(" + album_id + ", " + i + ");'>" + alb.tracks[i].title + "</p>";
				}

				track_list.innerHTML = code;
			}

			//This function generates code for the album list
			function generateAlbumList()
			{
				var code = "Albums:";
				for(i in albums)
				{
					code += "<p class='choice' onclick='generateTrackList(" + i + ");'>" + albums[i].artist + "/" + albums[i].title + "</p>";
				}

				album_list.innerHTML = code;
			}

			//This function will output the found contents in track list, whenever contents of search bar change
			function search()
			{
				var s = search_bar.value;
				code = "";

				if(s == "")
				{
					code = "No album selected";
				}
				else
				{
					for(i in albums)
					{
						var alb = albums[i];
						for(k in alb.tracks)
						{
							var track = alb.tracks[k];
							var low_title = track.title.toLowerCase();
							var low_lyrics = track.lyrics.toLowerCase();
							var in_title = false;
							var in_lyrics = false;
							var ti = low_title.indexOf(s);
							if(ti != -1) in_title = true;
							var li = low_lyrics.indexOf(s);
							if(li != -1) in_lyrics = true;

							if(in_title || in_lyrics)
							{
								code += "<p class='choice' onclick='generateSongData(" + i + ", " + k + ");'>";

								if(in_title)
								{
									code += track.title.substring(0, ti) +
											"<span class='found'>" + track.title.substring(ti, ti + s.length) + "</span>" +
											track.title.substring(ti + s.length, track.title.length);
								}
								else
								{
									code += track.title;
								}

								code += "<br />" + alb.artist + ", " + alb.title;

								if(in_lyrics)
								{
									code += "<br />";
									var start = track.lyrics.lastIndexOf(" ", li - 5);
									if(start == -1) start = 0;
									else start++;
									var end = track.lyrics.indexOf(" ", li + s.length + 5);
									if(end == -1) end = track.lyrics.length;
									if(start != 0) code += "...";
									code += track.lyrics.substring(start, li) +
											"<span class='found'>" + track.lyrics.substring(li, li + s.length) + "</span>" +
											track.lyrics.substring(li + s.length, end);
									if(end != track.lyrics.length) code += "...";
								}

								code += "</p>";
							}
						}
					}

					if(code == "")
					{
						code = "No matches found.";
					}
				}

				track_list.innerHTML = code;
			}

			//This function deletes last letter of the search bar
			function deleteLetter()
			{
				search_bar.value = search_bar.value.substring(0, search_bar.value.length - 1);
				search();
			}

			//This function inserts value of the clicked button into the search bar
			function insertLetter(c)
			{
				search_bar.value += c.toLowerCase();
				search();
			}

			//This function deletes all letters from the search bar
			function resetSearchBar()
			{
				search_bar.value = "";
				search();
			}

			//This function generates code for the keyboard used in the 'keyboard' div
			function generateKeyboard()
			{
				var qwerty = [ "QWERTYUIOP", "ASDFGHJKL", "ZXCVBNM" ];
				var code = "<form><input type='text' id='search_bar' onclick='search();' readonly></form>";

				for(i in qwerty)
				{
					code += "<div>";
					for(var k = 0; k < qwerty[i].length; k++)
					{
						code += "<div class='key' onclick='insertLetter(this.innerHTML);'>" + qwerty[i][k] + "</div>";
					}
					code += "</div>";
				}
				code += "<div><div class='key' onclick='insertLetter(\" \");'>SPACE</div>";
				code += "<div class='key' onclick='deleteLetter();'>BACK</div>";
				code += "<div class='key' onclick='resetSearchBar();'>RESET</div></div>";

				keyboard.innerHTML = code;
			}
		</script>
	</head>
	<body>
		<div id='album_list' class='display'>
		</div>
		<div id='track_list' class='display'>
		No album selected
		</div>
		<div id='current_track' class='display'>
		No song selected
		</div>
		<div id='keyboard'>
		</div>
		<script>
			generateAlbumList();
			generateKeyboard();
		</script>
	</body>
</html>